## Overview

This design describes the Action Framework within Eureka Streams. The Action Framework is the logical layer that contains the business logic for the system. This layer also controls the transactions to ensure ACID access to the underlying data within Eureka. Currently this design is broken into two parts, the Service and Async sides.

## Service action framework design

The following UML Class Diagram shows the relationships between the classes involved in describing the Service Action side of the Action Framework. This part of the Action Framework is responsible for handling Action calls from the web client.

![](images/AF_ServiceAction-Class-Diagram.jpg)

### ServiceActionContext

This is what is populated with the person model view of the context of the request. This is to be sure that we don't have to pass around the Spring object: UserDetails.

### ServiceAction

Provides the structure for the action and a concrete implementation of the Action Framework containing Validation, Authorization, and Execution Strategies.

### TaskHandlerServiceAction

Provide the submission implementation, this allows each action to specify its own submitter.

### TaskHandlerActionContext

This is a special ActionContext wrapper that the ServiceActionController uses to supply a TaskHandlerExecutionStrategy with a List of UserActionRequest objects. The ServiceActionController needs to be the one to supply this special context due to the way Spring loads up the Action instances. Since Spring, by default, loads the Actions as Singleton's the Action itself cannot maintain the List of UserActionRequest objects to be submitted to the TaskHandler because each request to that action would attempt to use the same shared memory. For this reason, the ServiceActionController creates a new instance of an empty List of UserActionRequests for each execution of an action, passes it to the action and passes the resulting requests onto the configured TaskHandler for that action.

### ServiceActionController

Responsibilities:

* Determine Security Context from Spring - this is handled by the ActionExecutor class.
* Load appropriate action - this is handled by the ActionExecutor class.
* Handle Transaction
* Perform execution order
* Supply a list of requests for the TaskHandlerExecutionStrategy to populate during execution.
* Post requests to the TaskHandler configured for the action being executed.
* Pass Undo state into Action if it implements the UndoableAction strategy
* Undo if exception is caught

## Async action framework design

The following UML Class Diagram shows the relationships between the classes the describe the Async Action side of the Action Framework. The Async Action side of the framework is responsible for execution of business logic that has been submitted to a job queue. This allows longer running processes to be off-loaded from the main web servers to provide a mechanism for scalability.

![](images/AF_AsyncAction-Class-Diagram.jpg)

### AsyncActionContext

This contains the context that is provided to the AsyncAction when the AsyncActionController is executing the AsyncAction provided by the MDB (Message Driven Bean). This context explicitly excludes the Principal for the execution. This is because the Principal under which the AsyncAction executes always is the MDB.

### AsyncAction

Null out getAuthorizationStrategy as part of the design. This helps enforce AsyncActions not having authorization as well as allow the design to communicate the difference between Service and Async Actions.

### TaskHandlerAsyncAction

Special type of AsyncAction that contains the mechanisms for configuring a TaskHandler to submit UserActionRequests through as well as using the TaskHandlerExecutionStrategy that provides the means for the AsyncActionController to gather up UserActionRequests.

### AsyncActionController

Responsibilities:

* Load action
* Handle transactions
* Perform execution order
* Provide a blank List of UserActionRequests to TaskHandlerAsyncActions so that the TaskHandlerExecutionStrategy can build up those requests during execution and provide them back to the controller for submission to the configured TaskHandler of the executing action.
* Post requests to the AsyncAction's configured TaskHandler.
* Pass Undo state into Action if it implements the UndoableAction interface
* Undo if exception is caught

## Sequence diagrams

![](images/Action-Framework.jpg)

The following diagram shows the dynamic flow of execution when a ServiceAction is executed within the action framework.

![](images/AF_ServiceActionController-Diagram.jpg)

The following diagram shows the dynamic flow of execution when a TaskHandlerServiceAction is executed within the action framework.

![](images/AF_ServiceActionController-With-Task-Handler-Diagram.jpg)